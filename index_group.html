<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Group-108</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        #map {
            height: 100vh;
            width: 100%;
        }
        .property {
            font-family: Arial, sans-serif;
            font-size: 14px;
        }
        .price {
            font-weight: bold;
        }
        .directions-button {
            background-color: #fff;
            color: #43308a;
            padding: 5px;
            cursor: pointer;
            margin-top: 5px;
            border: 1px solid;
            border-radius: 7px;
        }
        .directions-button:hover {
            background-color: #3069d1;
            color: white;
        }
        #property-select {
            position: relative;
            top: 5px;
            margin: 10px; /* Add margin for better spacing */
        }
        /* Responsive adjustments */
        @media (max-width: 768px) {
            #property-select {
                width: 90%; /* Use more width on smaller screens */
                margin: 10px auto; /* Center on smaller screens */
            }
            select {
                font-size: 16px; /* Increase font size for better readability */
            }
        }
    </style>
    <style>
      /* navbar css */
      .navbar {
        transition: background-color 0.3s ease;
        flex-direction: column;
        align-items: stretch;
        border-bottom: 1px solid #1a1b4b;
      }

      .navbar-light {
        background-color: transparent;
      }
      .nav-item {
        color: #1a1b4b;
      }
      .navbar-scrolled {
        background-color: #1a1b4b;
        img {
          filter: brightness(0) invert(1);
        }
        .nav-item {
          color: #fff;
        }
      }

      /* search input css */
      .search-container {
        padding: 10px 0;
        width: 100%;
      }

      .search-form {
        position: relative;
        display: flex;
        justify-content: center;
        /* width: 60%; */
        width: 100%;
        margin: 0 auto;
      }

      .search-input {
        border-radius: 5px;
        padding-left: 2.5rem; /* Space for icon */
        transition: width 0.4s ease-in-out;
        width: 100%;
      }

      .search-icon {
        position: absolute;
        top: 50%;
        left: 1rem; /* Position icon inside the input */
        transform: translateY(-50%);
        color: #6c757d;
      }

      /* footer css */

      .footer {
        background-color: #1a1b4b;
        bottom: 0;
        img {
          filter: brightness(0) invert(1);
          width: 20%;
          height: 4rem;
          margin: 5% 40%;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
      <div class="container">
        
        <a class="navbar-brand" href="#">
          <img src="./logo.png" alt="LOGO" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            <li class="nav-item">
                <div id="property-select" class="container">
                <select id="property-dropdown" class="form-control" onchange="moveToProperty()">
                    <option value="">Select a Property</option>
                </select>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-fluid bg-light">
      <div>
        <div id="map"></div>

        <script>
            let map;
            let directionsService;
            let directionsRenderer;
            let markers = [];
            let currentCircle;
            let currentLocationMarker;
            let currentLocation;  // Store the current location globally
    
            async function initMap() {
                const bounds = new google.maps.LatLngBounds();
                const center = { lat: 20.593684, lng: 78.962880 };
                map = new google.maps.Map(document.getElementById("map"), {
                    zoom: 5,
                    center
                });
    
                directionsService = new google.maps.DirectionsService();
                directionsRenderer = new google.maps.DirectionsRenderer();
                directionsRenderer.setMap(map);
    
                currentLocation = await getCurrentLocation();  // Get and store current location
                if (currentLocation) {
                    drawCircle(currentLocation, 0.01);
                    setCurrentLocationMarker(currentLocation);
                    bounds.extend(currentLocation);
                    addPropertiesToMap(currentLocation, bounds);
                    map.fitBounds(bounds);
                }
    
                populateDropdown();  // Populate the dropdown menu with properties
            }
    
            function drawCircle(location, radius) {
                if (currentCircle) {
                    currentCircle.setMap(null);
                }
    
                currentCircle = new google.maps.Circle({
                    strokeColor: "#4285f4",
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: "red",
                    fillOpacity: 0.35,
                    map,
                    center: location,
                    radius: radius * 1000,
                });
    
                map.setCenter(location);
                map.setZoom(20);
            }
    
            function setCurrentLocationMarker(location) {
                if (currentLocationMarker) {
                    currentLocationMarker.setMap(null);
                }
    
                currentLocationMarker = new google.maps.Marker({
                    position: location,
                    map,
                    title: "Your Location",
                    icon: {
                        url: "mapimage/man.png",
                        scaledSize: new google.maps.Size(40, 40),
                    },
                });
    
                map.setCenter(location);
            }
    
            async function getCurrentLocation() {
                return new Promise((resolve, reject) => {
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition((position) => {
                            resolve({
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                            });
                        }, reject);
                    } else {
                        reject("Geolocation is not supported by this browser.");
                    }
                });
            }
    
            function displayMarkers(properties) {
                clearMarkers();
                properties.forEach(property => {
                    const marker = new google.maps.Marker({
                        position: property.position,
                        map: map,
                        title: property.description,
                        icon: {
                            url: property.iconUrl,
                            scaledSize: new google.maps.Size(40, 40),
                        },
                    });
                    markers.push(marker);
                });
            }
    
            function clearMarkers() {
                markers.forEach(marker => marker.setMap(null));
                markers = [];
            }
    
            function addPropertiesToMap(currentLocation, bounds) {
                properties.forEach(property => {
                    const marker = new google.maps.Marker({
                        position: property.position,
                        map,
                        title: property.description,
                        icon: {
                            url: property.iconUrl,
                            scaledSize: new google.maps.Size(40, 40),
                        },
                    });
    
                    markers.push(marker);
                    marker.addListener("click", () => {
                        toggleHighlight(marker, property, currentLocation);
                    });
    
                    bounds.extend(property.position);
                    const distance = calculateDistance(currentLocation, property.position);
                    if (distance > 50) {
                        marker.setMap(null);
                    }
                });
            }
    
            function toggleHighlight(marker, property, currentLocation) {
                const content = buildContent(property, currentLocation);
                const infowindow = new google.maps.InfoWindow({
                    content: content,
                });
    
                infowindow.open(map, marker);
    
                google.maps.event.addListenerOnce(infowindow, 'domready', function () {
                    const directionsButton = document.querySelector('.directions-button');
                    if (directionsButton) {
                        directionsButton.addEventListener('click', () => {
                            getDirections(currentLocation, marker.getPosition(), property);
                        });
                    }
                });
            }
    
            function buildContent(property, currentLocation) {
                const distance = calculateDistance(currentLocation, property.position);
                return `
                    <div class="property">
                        <img src="${property.iconUrl}" alt="Property Logo" style="width:50px;height:50px;">
                        <div class="address">${property.address}</div>
                        <div class="name">${property.description}</div>
                        <div class="distance">Distance: ${distance.toFixed(2)} km</div>
                        <button class="directions-button">Get Directions</button>
                    </div>
                `;
            }
    
            function calculateDistance(location1, location2) {
                const R = 6371;
                const dLat = (location2.lat - location1.lat) * (Math.PI / 180);
                const dLng = (location2.lng - location1.lng) * (Math.PI / 180);
    
                const a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(location1.lat * (Math.PI / 180)) * Math.cos(location2.lat * (Math.PI / 180)) *
                    Math.sin(dLng / 2) * Math.sin(dLng / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            }
    
            async function getDirections(currentLocation, propertyPosition, property) {
                const request = {
                    origin: currentLocation,
                    destination: propertyPosition,
                    travelMode: google.maps.TravelMode.WALKING,
                };
    
                directionsService.route(request, (result, status) => {
                    if (status === google.maps.DirectionsStatus.OK) {
                        directionsRenderer.setDirections(result);
    
                        const route = result.routes[0];
                        const distance = route.legs[0].distance.text;
                        const duration = route.legs[0].duration.text;
    
                        const infowindow = new google.maps.InfoWindow({
                            content: `
                                <div class="property">
                                    <div class="address">${property.address}</div>
                                    <div class="distance">Distance: ${distance}</div>
                                    <div class="duration">Duration: ${duration}</div>
                                </div>
                            `,
                            position: propertyPosition
                        });
                        infowindow.open(map);
                    }
                });
            }
    
            function populateDropdown() {
                const dropdown = document.getElementById('property-dropdown');
                properties.forEach((property, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.text = property.description;
                    dropdown.appendChild(option);
                });
            }
    
            function moveToProperty() {
                const dropdown = document.getElementById('property-dropdown');
                const selectedIndex = dropdown.value;
    
                if (selectedIndex !== "") {
                    const property = properties[selectedIndex];
                    map.setCenter(property.position);
                    map.setZoom(21);
    
                    const marker = new google.maps.Marker({
                        position: property.position,
                        map,
                        title: property.description,
                        icon: {
                            url: property.iconUrl,
                            scaledSize: new google.maps.Size(40, 40),
                        },
                    });
    
                    google.maps.event.clearListeners(marker, 'click');
                    marker.addListener("click", () => {
                        toggleHighlight(marker, property, currentLocation);
                    });
    
                    google.maps.event.trigger(marker, 'click');
                }
            }
    
            const properties = [
            {
                    address: "HCPV+32G Greater Noida, Uttar Pradesh",
                    description: "Way to Party Yach",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.585178,
                        lng: 77.442574,
                    },
                    iconUrl: "mapimage/celebration.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },
                {
                    address: "HCMR+PQ9 Greater Noida, Uttar Pradesh",
                    description: "Water Body Area",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.584286,
                        lng: 77.441986,
                    },
                    iconUrl: "mapimage/area-graph.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },
                {
                    address: "HCPR+2G7 Greater Noida, Uttar Pradesh",
                    description: "Block  B Lift Loby",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.585041,
                        lng: 77.441299,
                    },
                    iconUrl: "mapimage/lobby.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },
                {
                    address: "HCMR+RPR Greater Noida, Uttar Pradesh",
                    description: "Block B Washroom",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.584616,
                        lng: 77.441757,
                    },
                    iconUrl: "mapimage/toilet.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },
                {
                    address: "HCMR+VJP Greater Noida, Uttar Pradesh",
                    description: "Block A Way To Parking",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.584723,
                        lng: 77.441589,
                    },
                    iconUrl: "mapimage/parking-lot.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },
                {
                    address: "HCMR+VJX Greater Noida, Uttar Pradesh",
                    description: "Retail Max",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.584728,
                        lng: 77.441597,
                    },
                    iconUrl: "mapimage/store.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },
                {
                    address: "HCMR+PX4 Greater Noida, Uttar Pradesh",
                    description: "Block c Escalator",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.584253,
                        lng: 77.442459,
                    },
                    iconUrl: "mapimage/escalator.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },
                {
                    address: "HCPV+23V Greater Noida, Uttar Pradesh",
                    description: "Reatil House Rarru",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.585100,
                        lng: 77.442658,
                    },
                    iconUrl: "mapimage/house.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },
                {
                    address: "HCPR+6X7 Greater Noida, Uttar Pradesh",
                    description: "Party Yard",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.585545,
                        lng: 77.442429,
                    },
                    iconUrl: "mapimage/celebration.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                }, 
                {
                    address: "HCMR+QFH Greater Noida, Uttar Pradesh",
                    description: "Retail peter england",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.584427,
                        lng: 77.441246,
                    },
                    iconUrl: "mapimage/supermarket.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },     
                {
                    address: "HCMR+MGM Greater Noida, Uttar Pradesh",
                    description: "Retail Flying Machine",
                    type: "home",
                    bed: 3,
                    bath: 3,
                    size: 2000,
                    position: {
                        lat: 28.584223,
                        lng: 77.441292,
                    },
                    iconUrl: "mapimage/machine.png",
                    logoUrl: "https://www.group-108.com/assets/images/logo.png", 
                },
            ];
            function searchProperties() {
                    const query = document.getElementById('search').value.toLowerCase();
                    const filteredProperties = properties.filter(property =>
                        property.description.toLowerCase().includes(query)
                    );
                    displayMarkers(filteredProperties);
                }
            window.initMap = initMap;
        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA4EsKdRs5FpeuW2y_pJz-VpGNLqVWQ4vI&callback=initMap" async defer></script>
        <!-- <iframe src="http://localhost/mapqr/testing.html" style="width: 100%; height: 700px; border: none;"  title="Embedded Map"></iframe> -->
      </div>
  </div>
  

    <!-- footer -->

    <div class="footer">
      <img src="./logo.png" alt="" />
    </div>

    <script>
      window.addEventListener("scroll", function () {
        const navbar = document.querySelector(".navbar");
        if (window.scrollY > 50) {
          navbar.classList.add("navbar-scrolled");
        } else {
          navbar.classList.remove("navbar-scrolled");
        }
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
